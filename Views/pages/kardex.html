<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Kardex - Mi Bodega</title>
    <style>
      :root {
        --color-primario: #005b99;
        --color-fondo: #f4f4f4;
        --color-texto: #333;
        --borde: #ccc;
      }

      body {
        margin: 0;
        font-family: "Segoe UI", sans-serif;
        background-color: var(--color-fondo);
        color: var(--color-texto);
      }

      header {
        background-color: #11101d;
        color: white;
        padding: 15px;
        text-align: center;
        font-size: 1.8em;
        font-weight: bold;
      }

      main {
        padding: 20px;
        max-width: 1200px;
        margin: auto;
      }

      .search-bar {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-bottom: 20px;
      }

      .search-bar input,
      .search-bar button {
        padding: 12px;
        font-size: 1em;
        border-radius: 5px;
        border: 1px solid var(--borde);
      }

      .search-bar button {
        background-color: var(--color-primario);
        color: white;
        cursor: pointer;
        border: none;
        transition: background 0.3s;
      }

      .search-bar button:hover {
        background-color: #003d66;
      }

      .info-panels {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        margin-bottom: 25px;
      }

      .info-box {
        flex: 1;
        min-width: 200px;
        background: white;
        padding: 15px;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      .info-box p {
        font-size: 1.2em;
        font-weight: bold;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        background: white;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      th,
      td {
        padding: 12px;
        text-align: left;
        border-bottom: 1px solid #ddd;
      }

      th {
        background-color: var(--color-primario);
        color: white;
      }

      tr:hover {
        background-color: #eef6ff;
      }

      .sticky-controls {
        display: flex;
        gap: 10px;
        margin-top: 20px;
        justify-content: flex-end;
      }

      .sticky-controls button {
        background-color: var(--color-primario);
        color: white;
        padding: 10px 15px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
      }

      .sticky-controls button:hover {
        background-color: #004070;
      }
    </style>
  </head>

  <body>
    <header>Kardex - Mi Bodega</header>

    <main>
      <div class="search-bar">
        <input
          id="productSearch"
          type="text"
          placeholder="Buscar por código, entidad o factura..."
        />
        <button onclick="filterTable()">Buscar</button>
        <input
          type="text"
          value="90002 Sandalias ergonómicas"
          readonly
          style="flex: 1"
        />
      </div>

      <section style="margin-top: 40px">
        <h2 style="margin-bottom: 15px">Registrar Movimiento</h2>
        <form
          id="movimientoForm"
          onsubmit="registrarMovimiento(event)"
          style="
            background: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
          "
        >
          <div
            style="
              display: grid;
              grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
              gap: 20px;
            "
          >
            <div>
              <label for="fecha"><strong>Fecha:</strong></label>
              <input
                type="date"
                id="fecha"
                name="fecha"
                required
                style="
                  width: 100%;
                  padding: 10px;
                  border: 1px solid #ccc;
                  border-radius: 5px;
                "
              />
            </div>

            <div>
              <label for="entidad"><strong>Entidad:</strong></label>
              <input
                type="text"
                id="entidad"
                name="entidad"
                placeholder="Nombre o código de entidad"
                required
                style="
                  width: 100%;
                  padding: 10px;
                  border: 1px solid #ccc;
                  border-radius: 5px;
                "
              />
            </div>

            <div>
              <label for="factura"><strong>Factura:</strong></label>
              <input
                type="text"
                id="factura"
                name="factura"
                placeholder="Nº Factura"
                required
                style="
                  width: 100%;
                  padding: 10px;
                  border: 1px solid #ccc;
                  border-radius: 5px;
                "
              />
            </div>

            <div>
              <label for="tipo"><strong>Tipo de Movimiento:</strong></label>
              <select
                id="tipo"
                name="tipo"
                required
                style="
                  width: 100%;
                  padding: 10px;
                  border: 1px solid #ccc;
                  border-radius: 5px;
                "
              >
                <option value="">Seleccione</option>
                <option value="entra">Entrada</option>
                <option value="sale">Salida</option>
              </select>
            </div>

            <div>
              <label for="cantidad"><strong>Cantidad:</strong></label>
              <input
                type="number"
                step="0.01"
                id="cantidad"
                name="cantidad"
                placeholder="0.00"
                required
                style="
                  width: 100%;
                  padding: 10px;
                  border: 1px solid #ccc;
                  border-radius: 5px;
                "
              />
            </div>

            <div>
              <label for="lote"><strong>Lote (código):</strong></label>
              <input
                type="text"
                id="lote"
                name="lote"
                placeholder="Código del lote"
                required
                style="
                  width: 100%;
                  padding: 10px;
                  border: 1px solid #ccc;
                  border-radius: 5px;
                "
              />
            </div>
          </div>

          <div style="margin-top: 20px; text-align: right">
            <button
              type="submit"
              style="
                padding: 12px 20px;
                background-color: #005b99;
                color: white;
                border: none;
                border-radius: 5px;
                font-size: 1em;
                cursor: pointer;
              "
            >
              Registrar Movimiento
            </button>
          </div>
        </form>
      </section>

      <div class="info-panels">
        <div class="info-box">
          <strong>Existencias</strong>
          <p id="existencias">18.00</p>
        </div>
        <div class="info-box">
          <strong>Stock Mínimo</strong>
          <p id="stockMinimo">0.00</p>
        </div>
        <div class="info-box">
          <strong>Opciones</strong>
          <p>
            <button onclick="alert('Usos del producto')">Usos</button>
            <button onclick="alert('Ver Kits')">Kits</button>
            <button onclick="alert('Ver Ubicación')">Ubicación</button>
          </p>
        </div>
      </div>

      <table>
        <thead>
          <tr>
            <th>FECHA</th>
            <th>ENTIDAD</th>
            <th>FACTURA</th>
            <th>ENTRA</th>
            <th>SALE</th>
            <th>SALDO</th>
            <th>LOTES</th>
          </tr>
        </thead>
        <tbody id="kardexBody">
          <!-- Contenido dinámico -->
        </tbody>
      </table>

      <div class="sticky-controls">
        <button onclick="masKardex()">+ Más Kardex</button>
        <button onclick="menosKardex()">- Menos Kardex</button>
      </div>
    </main>

    <script>
      const dataKardex = [
        {
          fecha: "22/04/2025",
          entidad: "ALMACEN GENERAL",
          factura: "292384576",
          entra: 1.0,
          sale: 0.0,
          saldo: 26.0,
          lotes: [{ codigo: "h1j234", cantidad: 1.0 }],
        },
        {
          fecha: "11/08/2024",
          entidad: "840-RECURSOS HUMANOS",
          factura: "292384576",
          entra: 0.0,
          sale: 2.0,
          saldo: 25.0,
          lotes: [
            { codigo: "2k123", cantidad: 1.0 },
            { codigo: "h1j234", cantidad: 1.0 },
          ],
        },
      ];

      function formatLotes(lotes) {
        return lotes
          .map((l) => `${l.cantidad} de lote ${l.codigo}`)
          .join("<br>");
      }

      function loadTable(data) {
        const tbody = document.getElementById("kardexBody");
        tbody.innerHTML = "";
        data.forEach((row) => {
          const tr = document.createElement("tr");
          tr.innerHTML = `
          <td>${row.fecha}</td>
          <td>${row.entidad}</td>
          <td>${row.factura}</td>
          <td>${row.entra.toFixed(2)}</td>
          <td>${row.sale.toFixed(2)}</td>
          <td>${row.saldo.toFixed(2)}</td>
          <td>${formatLotes(row.lotes)}</td>
        `;
          tbody.appendChild(tr);
        });
      }

      function filterTable() {
        const searchValue = document
          .getElementById("productSearch")
          .value.toLowerCase();
        const filtered = dataKardex.filter(
          (row) =>
            row.entidad.toLowerCase().includes(searchValue) ||
            row.factura.toLowerCase().includes(searchValue)
        );
        loadTable(filtered);
      }

      function masKardex() {
        alert(
          "Aquí se cargarían más registros desde una base de datos (paginación)"
        );
      }

      function menosKardex() {
        alert("Función para reducir los registros visibles");
      }

      function registrarMovimiento(e) {
        e.preventDefault();
        const form = document.getElementById("movimientoForm");
        const data = new FormData(form);

        const movimiento = {
          fecha: data.get("fecha"),
          entidad: data.get("entidad"),
          factura: data.get("factura"),
          entra:
            data.get("tipo") === "entra"
              ? parseFloat(data.get("cantidad"))
              : 0.0,
          sale:
            data.get("tipo") === "sale"
              ? parseFloat(data.get("cantidad"))
              : 0.0,
          saldo: 0,
          lotes: [
            {
              codigo: data.get("lote"),
              cantidad: parseFloat(data.get("cantidad")),
            },
          ],
        };

        dataKardex.unshift(movimiento);
        loadTable(dataKardex);
        form.reset();
      }

      loadTable(dataKardex);
    </script>
  </body>
</html>
